<!DOCTYPE html>
<html>
<head>
  <title>AI Campus Issue Reporter (Prototype)</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: Arial;
      padding: 30px;
      max-width: 500px;
    }
    input, textarea, button {
      width: 100%;
      margin-top: 10px;
      padding: 8px;
    }
    li {
      margin-top: 8px;
    }
  </style>
</head>

<body>

  <h2>AI Campus Issue Reporter</h2>


  <input id="title" placeholder="Issue title">
  <textarea id="desc" placeholder="Describe the issue"></textarea>
  <button onclick="submitIssue()">Submit Issue</button>

  <h3>Reported Issues</h3>
  <ul id="issueList"></ul>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAMDloZ419LN8YFGp9XB3w9LLGxeua_IM0",
  authDomain: "campus-issue.firebaseapp.com",
  projectId: "campus-issue",
  storageBucket: "campus-issue.firebasestorage.app",
  messagingSenderId: "615133636764",
  appId: "1:615133636764:web:1a0cf9ce74514aeda22559",
  measurementId: "G-P5S5VWCFD9"

  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ðŸ§  GEMINI API KEY
  const GEMINI_API_KEY = "AIzaSyAGSgtSEH-qpBu8KGemmTo_kD5e_BYiD3o";

  async function submitIssue() {
    const title = document.getElementById("title").value;
    const desc = document.getElementById("desc").value;

    if (!title || !desc) {
      alert("Please fill all fields");
      return;
    }

    // Gemini prompt
    const prompt = `
    Classify this campus issue into one category:
    Water, Electricity, WiFi, Hostel, Cleanliness, Other.

    Issue: ${title}. ${desc}

    Reply with only the category.
    `;

    // Call Gemini
    const response = await fetch(
      "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=" + GEMINI_API_KEY,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }]
        })
      }
    );

    const data = await response.json();
    const category =
      data.candidates?.[0]?.content?.parts?.[0]?.text || "Other";

    // Save to Firebase
    db.collection("issues").add({
      title,
      desc,
      category,
      time: new Date()
    });

    alert("Issue submitted!\nCategory: " + category);
  }

  // Live display
  db.collection("issues").onSnapshot(snapshot => {
    const list = document.getElementById("issueList");
    list.innerHTML = "";
    snapshot.forEach(doc => {
      const li = document.createElement("li");
      li.innerText =
        doc.data().title +
        " | " +
        doc.data().category;
      list.appendChild(li);
    });
  });
</script>

</body>
</html>
